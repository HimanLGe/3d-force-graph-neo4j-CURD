import { SSE } from './sse.js';

//data根据需求自定义参数
const data = {
    // 模型名称随意填写，如果不希望输出检索过程模型名称请包含silent_search
    "model": "kimi",
    "messages": [
        {
            "role": "user",
            "content": "你觉得kimi怎么样"
        }
    ],
    // 是否开启联网搜索，默认false
    "use_search": true,
    // 如果使用SSE流请设置为true，默认false
    "stream": true
};

//转数据为json字符串
var jsondata=JSON.stringify(data)

//创建sse对象，请求地址，参数，请求方法
let source = new SSE("http://127.0.0.1:8000/v1/chat/completions",
    {
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyLWNlbnRlciIsImV4cCI6MTcyMTY2MDY1NywiaWF0IjoxNzEzODg0NjU3LCJqdGkiOiJjb2pzcnM5a3FxNGhhdTRqaGE5MCIsInR5cCI6InJlZnJlc2giLCJzdWIiOiJjb2dodWxoa3FxNHR0cms3cTlpZyIsInNwYWNlX2lkIjoiY29naHVsaGtxcTR0dHJrN3E5aTAiLCJhYnN0cmFjdF91c2VyX2lkIjoiY29naHVsaGtxcTR0dHJrN3E5aGcifQ.9BKESFMx2vT3wwKG2i1mvo4tlfBTNxJKMyqzUgr7ILGZ1RhDmZuYWVbscBSN-tuRXj7P4zuESxo_fqHJIPMe-A'
        },
                    payload: jsondata,
                    method:'POST'});

//与后台连接成功触发的监听
source.addEventListener('open', function(e) {
 console.log("open")
 console.log('连接成功');
});

//接收到后台数据触发监听方法
source.addEventListener('message', function (event) {
console.log('收到数据', event);
});

//请求出错触发的监听方法
source.addEventListener('error', function(e) {
 console.error('请求出错：', e);
});

//数据传输完成关闭连接触发的监听方法
source.addEventListener('close', function(e) {
console.log('连接关闭');
});

//调用发起请求
source.stream();
